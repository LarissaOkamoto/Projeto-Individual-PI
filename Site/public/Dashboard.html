<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="Dashboard.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Elms+Sans:ital,wght@0,100..900;1,100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body onload="obterDados()">

<div class="body_dashboard">
    <div class="barra_lateral">
        <ul class="navbar">
        <div class="navbar_topo">
        <img src="Imagens\img-logo3.png" class="img-logo">
        <div class="login">
            <img src="" class="img-login">
            <p>Bem vindo(a)!</p>
        </div>
        <br/>
        <li>
            <a href="Dashboard.html" class="button_dashboard">Dashboard</a>
        </li>
        <br/>
        <li>
            <a href="Atividades.html" class="button_atividades">Atividades</a>
        </li>
        <br/>
        <li>
            <a href="Quiz.html" class="button_quiz">Quiz</a>
        </li>
        <br/>
        <br/>
        <li>
            <div class="button_sair" onclick="window.location.href='./Index.html';">
            <img src="Imagens/img-exit.png" class="img-exit">
            <a href="./Index.html" class="Login">Saír</a>
            </div>
        </li>
        </div>
        <div class="contatos">
            <b>Contatos</b>
            <br/>
            <br/>
            <img src="Imagens/img-telefone.png" class="img-telefone">
            +55 11 3000-0000
            <br/>
            <img src="Imagens/img-email.png" class="img-email">
            umui@outlook.com
            <br/>
            <img src="Imagens/img-instagram.png" class="img-instagram">
            @Umui.Project
        </div>
        </ul>
    </div>

    <div class="dashboard">
        <img src="Imagens\img-header_dashboard.png" class="img-header_dashboard">
        <div class="explicacao">
            <h2>Olá, vamos começar a construir uma memória especial?</h2>
            Este é um espaço para eternizar histórias, homenagens e lembranças.
        </div>
        <br/>
        <hr class="divider">
        <div class="inicie_projeto">

            <div class="continuar_projeto">
            <h3>Continuar o projeto</h3>
            <div class="body_atividades">
            <div class="atividades_1a3">
            <li>
                <div class="button_atividade_individual1" id="button_atividade_individual1" onclick="window.location.href='Atividade1.html';">
                <img src="Imagens\img-atividade1.png" class="img-atividade1">
                <a href="Atividade1.html" class="button_atividades">Atividade 1</a>
                </div>
            </li>
            <li>
                <div class="button_atividade_individual2" onclick="window.location.href='Atividade2.html';">
                <img src="Imagens\img-atividade2.png" class="img-atividade2">
                <a href="Atividade2.html" class="button_atividades">Atividade 2</a>
                </div>
            </li>
            <li>
                <div class="button_atividade_individual3" onclick="window.location.href='Atividade3.html';">
                <img src="Imagens\img-atividade3.png" class="img-atividade3">
                <a href="Atividade3.html" class="button_atividades">Atividade 3</a>
                </div>
            </li>
            </div>
            <div class="atividades_4a6">
            <li>
                <div class="button_atividade_individual4" onclick="window.location.href='Atividade4.html';">
                <img src="Imagens\img-atividade4.png" class="img-atividade4">
                <a href="Atividade4.html" class="button_atividades">Atividade 4</a>
                </div>
            </li>
            <li>
                <div class="button_atividade_individual5" onclick="window.location.href='Atividade5.html';">
                <img src="Imagens\img-atividade5.png" class="img-atividade5">
                <a href="Atividade5.html" class="button_atividades">Atividade 5</a>
                </div>
            </li>
            <li>
                <div class="button_atividade_individual6" onclick="window.location.href='Atividade6.html';">
                <img src="Imagens\img-atividade6.png" class="img-atividade6">
                <a href="Atividade6.html" class="button_atividades">Atividade 6</a>
                </div>
            </li>
            </div>
            </div>
            </div>

            <div class="novo_projeto">
                <h3>Iniciar um novo projeto</h3>
                Monte um novo projeto para uma pessoa especial!
                <br/>
                <br/>
                <img src="Imagens\img-album6.png" class="img-novo_projeto">
                <br/>
                <br/>
                <li>
                <a onclick="novo_projeto()" class="button_novo_projeto">Inicie o seu novo projeto!</a>
                </li>
            </div>

        </div>
        <hr class="divider">
        <div class="dados_andamento">
            <h2>Acompanhe o seu projeto ...</h2>
            <div class="andamento">
                <img src="Imagens\img-album.png" class="img-album">
                <div class="metricas_grafico">
                <div class="metricas">
                    <div class="kpi_andamento">
                    <h3>Porcentagem de conclusão total do projeto</h3>
                    <br/>
                    <div id="div_mensagem_porcentagem" class ="texto_porcentagem"></div>
                    <br/>
                    Uma história se concretizando ...
                    <br/>
                    </div>
                </div>
                <div class="grafico">
                    Andamento do Projeto:
                    <div class="grafico1_2">
                        <div>
                        <canvas id="pie" class="grafico1" width="350px" height="350px"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    
</body>
</html>

<script>
function obterDados(){

var idProjeto = 1;

var resposta1 = ""
var resposta2 = ""
var resposta3 = ""

fetch(`/atividades/porcentagemConcluido/`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(async function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    resposta1 = await resposta

                });
            } else {

                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });

fetch(`/atividades/porcentagemPendente/`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(async function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    
                    resposta2 = await resposta

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
        
        setTimeout(() => plotarGraficoPie(resposta1[0], resposta2[0]), 2000);


        fetch(`/atividades/porcentagemGeral/`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(async function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                    resposta3 = await resposta;
                });
            } else {

                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });

        setTimeout(() => gerarkpi(resposta3[0]), 2000);
}


function gerarkpi(porcentagemGeral){
    console.log(porcentagemGeral.geralConcluido)
    porcentagemTotal = (porcentagemGeral.geralConcluido/6)*100;

    div_mensagem_porcentagem.innerHTML = `${porcentagemTotal.toFixed(1)}%`;
}


function plotarGraficoPie(porcentagemConcluido, porcentagemAndamento){

  console.log(porcentagemAndamento.pendente)
  console.log(porcentagemConcluido.concluido)

  const ctx = document.getElementById('pie');

  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Concluido','Pendente'],
      datasets: [{
        label: 'Andamento das Atividades',
        data: [porcentagemConcluido.concluido, porcentagemAndamento.pendente],
        backgroundColor: ['rgb(153, 207, 112)', 'rgb(241, 128, 128)'],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
} 

function novo_projeto(){
    alert(`
    Sua solicitação para um novo projeto foi enviado para a nossa equipe! 

    Assim que possível, entraremos em contato para iniciarmos uma nova história...
    `)
}
    
</script>