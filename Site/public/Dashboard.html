<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="Dashboard.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Elms+Sans:ital,wght@0,100..900;1,100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body onload="obterDados()">

<div class="body_dashboard">
    <div class="barra_lateral">
        <ul class="navbar">
        <div class="navbar_topo">
        <img src="Imagens\img-logo3.png" class="img-logo">
        <div class="login">
            <img src="" class="img-login">
            <p>Bem vindo(a)!</p>
        </div>
        <br/>
        <li>
            <a href="Dashboard.html" class="button_dashboard">Dashboard</a>
        </li>
        <br/>
        <li>
            <a href="Atividades.html" class="button_atividades">Atividades</a>
        </li>
        <br/>
        <br/>
        <li>
            <div class="button_sair" onclick="window.location.href='./Index.html';">
            <img src="Imagens/img-exit.png" class="img-exit">
            <a href="./Index.html" class="Login">Saír</a>
            </div>
        </li>
        </div>
        <div class="contatos">
            <b>Contatos</b>
            <br/>
            <br/>
            <img src="Imagens/img-telefone.png" class="img-telefone">
            +55 11 3000-0000
            <br/>
            <img src="Imagens/img-email.png" class="img-email">
            umui@outlook.com
            <br/>
            <img src="Imagens/img-instagram.png" class="img-instagram">
            @Umui.Project
        </div>
        </ul>
    </div>

    <div class="dashboard">
        <img src="Imagens\img-header_dashboard.png" class="img-header_dashboard">
        <div class="explicacao">
            <h2>Olá, vamos começar a construir uma memória especial?</h2>
            Este é um espaço para eternizar histórias, homenagens e lembranças.
        </div>
        <br/>
        <hr class="divider">
        <div class="inicie_projeto">

            <div class="continuar_projeto">
            <h3>Continuar o projeto</h3>
            <div class="body_atividades">
            <div class="atividades_1a3">
            <li>
                <div class="button_atividade_individual1" onclick="window.location.href='Atividade1.html';">
                <img src="Imagens\img-atividade1.png" class="img-atividade1">
                <a href="Atividade1.html" class="button_atividades">Atividade 1</a>
                </div>
            </li>
            <li>
                <div class="button_atividade_individual2" onclick="window.location.href='Atividade2.html';">
                <img src="Imagens\img-atividade2.png" class="img-atividade2">
                <a href="Atividade2.html" class="button_atividades">Atividade 2</a>
                </div>
            </li>
            <li>
                <div class="button_atividade_individual3" onclick="window.location.href='Atividade3.html';">
                <img src="Imagens\img-atividade3.png" class="img-atividade3">
                <a href="Atividade3.html" class="button_atividades">Atividade 3</a>
                </div>
            </li>
            </div>
            <div class="atividades_4a6">
            <li>
                <div class="button_atividade_individual4" onclick="window.location.href='Atividade4.html';">
                <img src="Imagens\img-atividade4.png" class="img-atividade4">
                <a href="Atividade4.html" class="button_atividades">Atividade 4</a>
                </div>
            </li>
            <li>
                <div class="button_atividade_individual5" onclick="window.location.href='Atividade5.html';">
                <img src="Imagens\img-atividade5.png" class="img-atividade5">
                <a href="Atividade5.html" class="button_atividades">Atividade 5</a>
                </div>
            </li>
            <li>
                <div class="button_atividade_individual6" onclick="window.location.href='Atividade6.html';">
                <img src="Imagens\img-atividade6.png" class="img-atividade6">
                <a href="Atividade6.html" class="button_atividades">Atividade 6</a>
                </div>
            </li>
            </div>
            </div>
            </div>

            <div class="novo_projeto">
                <h3>Iniciar um novo projeto</h3>
                Monte um novo projeto para uma pessoa especial!
                <br/>
                <br/>
                <img src="Imagens\img-album6.png" class="img-novo_projeto">
                <br/>
                <br/>
                <li>
                <a href="" class="button_novo_projeto">Inicie o seu novo projeto!</a>
                </li>
            </div>

        </div>
        <hr class="divider">
        <div class="dados_andamento">
            <h2>Acompanhe o seu projeto ...</h2>
            <div class="andamento">
                <img src="Imagens\img-album.png" class="img-album">
                <div class="metricas_grafico">
                <div class="metricas">
                    <div class="kpi_andamento">
                    <h3>Porcentagem de conclusão total do projeto</h3>
                    <br/>
                    <div id="div_mensagem" class ="texto_porcentagem"></div>
                    <br/>
                    Uma história se concretizando ...
                    <br/>
                    
                    </div>
                </div>
                <div class="grafico">
                    Porcentagem de progresso %
                    <div class="grafico1_2">
                        <div>
                        <canvas id="myChart" class="grafico1" width="350px" height="350px"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    
</body>
</html>

<script>
    var porcentagemTotal = 0;

    function obterDadosGrafico(idProjeto) {

        alterarTitulo(idProjeto)

        if (proximaAtualizacao != undefined) {
            clearTimeout(proximaAtualizacao);
        }

        fetch(`/projeto/ultimas/${idProjeto}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGraficoPie(resposta, idProjeto);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

        //var soma = Number(dados[0].Andamento) + Number(dados[1].Andamento) + Number(dados[2].Andamento) + Number(dados[3].Andamento) + Number(dados[4].Andamento) + Number(dados[5].Andamento);
        //var porcentagem = (soma / dados.length) * 100

        //div_mensagem.innerHTML = `${Number(porcentagem).toFixed(0)}%`;

        //porcentagemTotal = porcentagem;
    }

    

  


/*function plotarGraficoBarra(dados){

  var Atividade = [];
  var Andamento = [];
  var Atividades = [`Conclusão do Projeto final`];

  // Preenchendo os arrays com os dados
  for(var i = 0; i < dados.length; i++){
    Atividade.push(dados[i].Atividade);
    Andamento.push(dados[i].Andamento);
  }
var ctx = document.getElementById('barra1').getContext('2d');
  // Criando o gráfico de barra usando o Chart.js
  var myChart = new Chart(ctx, {
      type: 'bar', // Tipo de gráfico: barra
      data: { // Dados para o gráfico
          labels: Atividade, // Rótulos no eixo X
          datasets: [{
              label: 'Atividades Completas', // Nome do conjunto de dados
              data: Andamento, // Dados dos votos
              backgroundColor: [
                  'rgba(185, 149, 115, 0.2)', // Cor de fundo das barras
              ],
              borderColor: [
                  'rgba(185, 149, 115, 1)', // Cor da borda das barras
              ],
              borderWidth: 1 // Largura da borda das barras
          }]
      },
  });

  var ctx = document.getElementById('barra2').getContext('2d');
  // Criando o gráfico de barra usando o Chart.js
  
  porcentagemTotal
  var myChart = new Chart(ctx, {
      type: 'bar', // Tipo de gráfico: barra
      data: { // Dados para o gráfico
          labels: Atividades, // Rótulos no eixo X
          datasets: [{
              label: 'Porcentagem concluída', // Nome do conjunto de dados
              data: [porcentagemTotal], // Dados dos votos
              backgroundColor: [
                  'rgba(134, 171, 82, 0.2)', // Cor de fundo das barras
              ],
              borderColor: [
                  'rgba(134, 171, 82, 1)', // Cor da borda das barras
              ],
              borderWidth: 1 // Largura da borda das barras
          }]
      },
      options: {
        scales: {
            y: {
                beginAtZero: true,
                max: 100
            }
        }
    }
  });
}
*/


function plotarGraficoPie(dados){

const DATA_COUNT = 6;
const NUMBER_CFG = {count: DATA_COUNT, min: 0, max: 6};

var ctx = document.getElementById('pie').getContext('2d');

  var myChart = new Chart(ctx, {
  type: 'pie',
  data:{
    labels: ['Red', 'Blue'],
    datasets: [
    {
      label: 'Atividades Completas',
      data: [porcentagemConcluida],
      backgroundColor: Object.values(Utils.CHART_COLORS),
    },
    {
      label: 'Atividades Pendentes',
      data: [porcentagemPendente],
      backgroundColor: Object.values(Utils.CHART_COLORS),
    },
    ]
    },
    options: {
        responsive: true,
        plugins: {
        legend: {
            position: 'top',
        },
        title: {
            display: true,
            text: 'Chart.js Pie Chart'
        }
        }
    },
});

}

/*function atualizarGrafico(idProjeto, dados, myChart) {


        fetch(`/projeto/tempo-real/${idAquario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {

                    obterdados(idAquario);
                    // alertar(novoRegistro, idAquario);
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dados);

                    let avisoCaptura = document.getElementById(`avisoCaptura${idAquario}`)
                    avisoCaptura.innerHTML = ""


                    if (novoRegistro[0].momento_grafico == dados.labels[dados.labels.length - 1]) {
                        console.log("---------------------------------------------------------------")
                        console.log("Como não há dados novos para captura, o gráfico não atualizará.")
                        avisoCaptura.innerHTML = "<i class='fa-solid fa-triangle-exclamation'></i> Foi trazido o dado mais atual capturado pelo sensor. <br> Como não há dados novos a exibir, o gráfico não atualizará."
                        console.log("Horário do novo dado capturado:")
                        console.log(novoRegistro[0].momento_grafico)
                        console.log("Horário do último dado capturado:")
                        console.log(dados.labels[dados.labels.length - 1])
                        console.log("---------------------------------------------------------------")
                    } else {
                        // tirando e colocando valores no gráfico
                        dados.labels.shift(); // apagar o primeiro
                        dados.labels.push(novoRegistro[0].momento_grafico); // incluir um novo momento

                        dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                        dados.datasets[0].data.push(novoRegistro[0].umidade); // incluir uma nova medida de umidade

                        dados.datasets[1].data.shift();  // apagar o primeiro de temperatura
                        dados.datasets[1].data.push(novoRegistro[0].temperatura); // incluir uma nova medida de temperatura

                        myChart.update();
                    }

                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => atualizarGrafico(idAquario, dados, myChart), 2000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

}*/


    
</script>